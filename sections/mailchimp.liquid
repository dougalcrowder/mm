{% comment %}
https://realpowerofone.us20.list-manage.com/subscribe/post?u=fde30870205a640d93c128964&amp;id=a6595f8345
{% endcomment %}

{{ 'mailchimp.css' | asset_url | stylesheet_tag }}

<div class="mailchimp-section{% if section.settings.image != blank %} image flex{% endif %}">
  <form action="{{ section.settings.chimp_url }}" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
    {% if section.settings.section_title != blank %}
    <h3>{{ section.settings.section_title }}</h3>
    {% endif %}
    
    {% if section.settings.subheading != blank %}
    <div class="rte">{{ section.settings.subheading }}</div>
    {% endif %}
    
    {% if section.settings.show_name %} 
    <div>
      <label for="mce-FNAME">First Name</label>
      <input type="text" name="FNAME" id="mce-FNAME">
    </div>
    {% endif %}
    <div>
      <label class="visibility-hidden" for="mce-EMAIL">Email Address</label>
      <input type="email" name="EMAIL" placeholder="Email Address" id="mce-EMAIL" title="The domain portion of the email address is invalid (the portion after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" required>
    </div>
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" tabindex="-1" value=""></div>
      <div class="mc-status"></div>
      <div><input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
  </form>
  <button id="closeThis" class="closeMonkey"><span class="line1"></span><span class="line2"></span><span class="visually-hidden">Close</span></button>
  
 {% if section.settings.image != blank %}
 <div class="chimpimage">
    <picture>
      <source srcset="{{ section.settings.image | img_url: '250x500', crop: 'center' }}" media="(min-width: 768px)" />
      <img loading="lazy" class="lazyloadthisatsomepoint" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="{{ section.settings.image.alt | escape }}" width="5" height="10" />
    </picture>
 </div>
  {% endif %}
</div>

<script>
  !function(){function e(e,o,t,n,r,s,c){var i="";if(t)switch(t.constructor){case Number:i=t===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+t;break;case String:i="; expires="+t;break;case Date:i="; expires="+t.toUTCString()}return encodeURIComponent(e)+"="+encodeURIComponent(o)+i+(r?"; domain="+r:"")+(n?"; path="+n:"")+(s?"; secure":"")+(!c||"no_restriction"===c.toString().toLowerCase()||c<0?"":"lax"===c.toString().toLowerCase()||1===Math.ceil(c)||!0===c?"; samesite=lax":"; samesite=strict")}var o=/[\-\.\+\*]/g,t=/^(?:expires|max\-age|path|domain|secure|samesite|httponly)$/i;window.docCookies={getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(o,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(o,n,r,s,c,i,a){return!(!o||t.test(o))&&(document.cookie=e(o,n,r,s,c,i,a),!0)},removeItem:function(o,t,n,r,s){return!!this.hasItem(o)&&(document.cookie=e(o,"","Thu, 01 Jan 1970 00:00:00 GMT",t,n,r,s),!0)},hasItem:function(e){return!(!e||t.test(e))&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(o,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),o=e.length,t=0;t<o;t++)e[t]=decodeURIComponent(e[t]);return e},clear:function(e,o,t,n){for(var r=this.keys(),s=r.length,c=0;c<s;c++)this.removeItem(r[c],e,o,t,n)}}}(),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=docCookies);
  
  //cookies
  function maxAgeToGMT (nMaxAge) {
  return nMaxAge === Infinity ? "Fri, 31 Dec 9999 23:59:59 GMT" : (new Date(nMaxAge * 1e3 + Date.now())).toUTCString();
  }
  
  if (document.getElementById('shopify-section-mailchimp')) {
    const closeThis = document.getElementById('closeThis');
    const theThis = document.getElementById('shopify-section-mailchimp');
    if (docCookies.hasItem("mailchimpPopup")) { 
      // tumbleweed
    } else {
      window.setTimeout( function() {
        theThis.classList.add('active');
      }, 10000); 
      closeThis.addEventListener('click',function(e) {
        docCookies.setItem("mailchimpPopup", "Seen", maxAgeToGMT(31536000), "/");
        theThis.classList.remove('active');
      });
    }
  }
  
  
  if (docCookies.hasItem("mailchimpPopup")) {
    console.log("Not happening");
  } else {
  console.log("happening");
  // Add the novalidate attribute when the JS loads
  var forms = document.querySelectorAll('.validate');
  for (var i = 0; i < forms.length; i++) {
    forms[i].setAttribute('novalidate', true);
  }
  
  
  // Validate the field
  var hasError = function (field) {
  
    // Don't validate submits, buttons, file and reset inputs, and disabled fields
    if (field.disabled || field.type === 'file' || field.type === 'reset' || field.type === 'submit' || field.type === 'button') return;
  
    // Get validity
    var validity = field.validity;
  
    // If valid, return null
    if (validity.valid) return;
  
    // If field is required and empty
    if (validity.valueMissing) return 'Please fill out this field.';
  
    // If not the right type
    if (validity.typeMismatch) {
  
      // Email
      if (field.type === 'email') return 'Please enter an email address.';
  
      // URL
      if (field.type === 'url') return 'Please enter a URL.';
  
    }
  
    // If too short
    if (validity.tooShort) return 'Please lengthen this text to ' + field.getAttribute('minLength') + ' characters or more. You are currently using ' + field.value.length + ' characters.';
  
    // If too long
    if (validity.tooLong) return 'Please shorten this text to no more than ' + field.getAttribute('maxLength') + ' characters. You are currently using ' + field.value.length + ' characters.';
  
    // If pattern doesn't match
    if (validity.patternMismatch) {
  
      // If pattern info is included, return custom error
      if (field.hasAttribute('title')) return field.getAttribute('title');
  
      // Otherwise, generic error
      return 'Please match the requested format.';
  
    }
  
    // If number input isn't a number
    if (validity.badInput) return 'Please enter a number.';
  
    // If a number value doesn't match the step interval
    if (validity.stepMismatch) return 'Please select a valid value.';
  
    // If a number field is over the max
    if (validity.rangeOverflow) return 'Please select a value that is no more than ' + field.getAttribute('max') + '.';
  
    // If a number field is below the min
    if (validity.rangeUnderflow) return 'Please select a value that is no less than ' + field.getAttribute('min') + '.';
  
    // If all else fails, return a generic catchall error
    return 'The value you entered for this field is invalid.';
  
  };
  
  
  // Show an error message
  var showError = function (field, error) {
  
    // Add error class to field
    field.classList.add('error');
    
    // If the field is a radio button and part of a group, error all and get the last item in the group
    if (field.type === 'radio' && field.name) {
      var group = field.form.querySelectorAll('[name="' + field.name + '"]');
      if (group.length > 0) {
        for (var i = 0; i < group.length; i++) {
          group[i].classList.add('error');
        }
        field = group[group.length - 1];
      }
    }
  
    // Get field id or name
    var id = field.id || field.name;
    if (!id) return;
  
    // Check if error message field already exists
    // If not, create one
    var message = field.form.querySelector('.error-message#error-for-' + id );
    if (!message) {
      message = document.createElement('div');
      message.className = 'error-message';
      message.id = 'error-for-' + id;
      
      // If the field is a radio button or checkbox, insert error after the label
      var label;
      if (field.type === 'radio' || field.type ==='checkbox') {
        label = field.form.querySelector('label[for="' + id + '"]') || field.parentNode;
        if (label) {
          label.parentNode.insertBefore( message, label.nextSibling );
        }
      }
  
      // Otherwise, insert it after the field
      if (!label) {
        field.parentNode.insertBefore( message, field.nextSibling );
      }
  
    }
    
    // Add ARIA role to the field
    field.setAttribute('aria-describedby', 'error-for-' + id);
  
    // Update error message
    message.innerHTML = error;
  
    // Show error message
    message.style.display = 'block';
    message.style.visibility = 'visible';
  
  };
  
  
  // Remove the error message
  var removeError = function (field) {
  
    // Remove error class to field
    field.classList.remove('error');
    
    // Remove ARIA role from the field
    field.removeAttribute('aria-describedby');
  
    // If the field is a radio button and part of a group, remove error from all and get the last item in the group
    if (field.type === 'radio' && field.name) {
      var group = field.form.querySelectorAll('[name="' + field.name + '"]');
      if (group.length > 0) {
        for (var i = 0; i < group.length; i++) {
          group[i].classList.remove('error');
        }
        field = group[group.length - 1];
      }
    }
  
    // Get field id or name
    var id = field.id || field.name;
    if (!id) return;
    
  
    // Check if an error message is in the DOM
    var message = field.form.querySelector('.error-message#error-for-' + id + '');
    if (!message) return;
  
    // If so, hide it
    message.innerHTML = '';
    message.style.display = 'none';
    message.style.visibility = 'hidden';
  
  };
  
  // Serialize the form data into a query string
  // Forked and modified from https://stackoverflow.com/a/30153391/1293256
  var serialize = function (form) {
    
    // Setup our serialized data
    var serialized = '';
    
    // Loop through each field in the form
    for (i = 0; i < form.elements.length; i++) {
  
      var field = form.elements[i];
  
      // Don't serialize fields without a name, submits, buttons, file and reset inputs, and disabled fields
      if (!field.name || field.disabled || field.type === 'file' || field.type === 'reset' || field.type === 'submit' || field.type === 'button') continue;
  
      // Convert field data to a query string
      if ((field.type !== 'checkbox' && field.type !== 'radio') || field.checked) {
        serialized += '&' + encodeURIComponent(field.name) + "=" + encodeURIComponent(field.value);
      }
    }
  
    return serialized;
  
  };
  
  // Display the form status
  window.displayMailChimpStatus = function (data) {
  
    // Make sure the data is in the right format and that there's a status container
    if (!data.result || !data.msg || !mcStatus ) return;
  
    // Update our status message
    mcStatus.innerHTML = data.msg;
  
    // If error, add error class
    if (data.result === 'error') {
      mcStatus.classList.remove('success-message');
      mcStatus.classList.add('error-message');
      return;
    }
  
    // Otherwise, add success class
    mcStatus.classList.remove('error-message');
    mcStatus.classList.add('success-message');
  };
  
  // Submit the form
  var submitMailChimpForm = function (form) {
  
    // Get the Submit URL
    var url = form.getAttribute('action');
    url = url.replace('/post?u=', '/post-json?u=');
    url += serialize(form) + '&c=displayMailChimpStatus';
  
    // Create script with url and callback (if specified)
    var ref = window.document.getElementsByTagName( 'script' )[ 0 ];
    var script = window.document.createElement( 'script' );
    script.src = url;
  
    // Create a global variable for the status container
    window.mcStatus = form.querySelector('.mc-status');
  
    // Insert script tag into the DOM (append to <head>)
    ref.parentNode.insertBefore( script, ref );
  
    // After the script is loaded (and executed), remove it
    script.onload = function () {
      this.remove();
    };
  
  };
  
  // Listen to all blur events
  document.addEventListener('blur', function (event) {
  
    // Only run if the field is in a form to be validated
    if (!event.target.form.classList.contains('validate')) return;
  
    // Validate the field
    var error = hasError(event.target);
    
    // If there's an error, show it
    if (error) {
      showError(event.target, error);
      return;
    }
  
    // Otherwise, remove any existing error message
    removeError(event.target);
  
  }, true);
  
  
  // Check all fields on submit
  document.addEventListener('submit', function (event) {
  
    // Only run on forms flagged for validation
    if (!event.target.classList.contains('validate')) return;
  
    // Prevent form from submitting
    event.preventDefault();
  
    // Get all of the form elements
    var fields = event.target.elements;
  
    // Validate each field
    // Store the first field with an error to a variable so we can bring it into focus later
    var error, hasErrors;
    for (var i = 0; i < fields.length; i++) {
      error = hasError(fields[i]);
      if (error) {
        showError(fields[i], error);
        if (!hasErrors) {
          hasErrors = fields[i];
        }
      }
    }
  
    // If there are errrors, don't submit form and focus on first element with error
    if (hasErrors) {
      hasErrors.focus();
    }
    
    // Otherwise, let the form submit normally
    // You could also bolt in an Ajax form submit process here
    docCookies.setItem("mailchimpPopup", "Seen", maxAgeToGMT(31536000), "/");
    submitMailChimpForm(event.target);
    
  }, false);
  
  }
  </script>

{% schema %}
{
  "name": {
    "en": "Mailchimp Newsletter"
  },
  "class": "index-section mailychimpster",
  "settings": [
    {
      "type": "text",
      "id": "chimp_url",
      "label": {
        "en": "Mailchimp form url"
      }
    },
    {
      "type": "text",
      "id": "section_title",
      "label": {
        "en": "Heading"
      },
      "default": {
        "en": "Subscribe to our newsletter"
      }
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": {
        "en": "Subheading"
      },
      "default": {
        "en": "<p>Promotions, new products and sales. Directly to your inbox.</p>"
      }
    },
    {
    "type": "image_picker",
      "id": "image",
      "label": {
        "en": "Image"
      }
    },
    {
      "id": "show_name",
      "type": "checkbox",
      "label": {
        "en": "Show First Name Field"
      },
      "default": true
    }
  ],
  "presets": [
    {
      "name": {
        "en": "Mailchimp Newsletter"
      },
      "category": {
        "en": "Promotional"
      }
    }
  ]
}
{% endschema %}
