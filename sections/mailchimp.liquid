{% comment %}
https://mollymahon.us10.list-manage.com/subscribe/post?u=97f9cc90b67785f171c4e5e7a&amp;id=03514ce382
{% endcomment %}

{%- if section.settings.disable -%}
{%- else -%}
{%- assign mailchimpJs = true -%}
<div class="mailchimp-section{% if section.settings.image != blank %} image flex{% endif %}">
  <form action="{{ section.settings.chimp_url }}" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
    {% if section.settings.section_title != blank %}
    <h3>{{ section.settings.section_title }}</h3>
    {% endif %}
    
    {% if section.settings.subheading != blank %}
    <div class="rte">{{ section.settings.subheading }}</div>
    {% endif %}
    
    {% if section.settings.show_name %} 
    <div>
      <label class="visually-hidden" for="mce-FNAME">First Name</label>
      <input type="text" name="FNAME" id="mce-FNAME" placeholder="Name">
    </div>
    {% endif %}
    <div>
      <label class="visibility-hidden" for="mce-EMAIL">Email Address</label>
      <input type="email" name="EMAIL" placeholder="Email Address" id="mce-EMAIL" title="The domain portion of the email address is invalid (the portion after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" required>
    </div>
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" tabindex="-1" value=""></div>
      <div class="mc-status"></div>
      <div><input type="submit" value="Sign me up!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
  </form>
  <button id="closeThis" class="closeMonkey"><span class="line1"></span><span class="line2"></span><span class="visually-hidden">Close</span></button>
  
 {% if section.settings.image != blank %}
 <div class="chimpimage">
    <picture>
      <source srcset="{{ section.settings.image | img_url: '250x500', crop: 'center' }}" media="(min-width: 768px)" />
      <img loading="lazy" class="lazyloadthisatsomepoint" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="{{ section.settings.image.alt | escape }}" width="5" height="10" />
    </picture>
 </div>
  {% endif %}
</div>

<script>
  !function(){function e(e,o,t,n,r,s,c){var i="";if(t)switch(t.constructor){case Number:i=t===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+t;break;case String:i="; expires="+t;break;case Date:i="; expires="+t.toUTCString()}return encodeURIComponent(e)+"="+encodeURIComponent(o)+i+(r?"; domain="+r:"")+(n?"; path="+n:"")+(s?"; secure":"")+(!c||"no_restriction"===c.toString().toLowerCase()||c<0?"":"lax"===c.toString().toLowerCase()||1===Math.ceil(c)||!0===c?"; samesite=lax":"; samesite=strict")}var o=/[\-\.\+\*]/g,t=/^(?:expires|max\-age|path|domain|secure|samesite|httponly)$/i;window.docCookies={getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(o,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(o,n,r,s,c,i,a){return!(!o||t.test(o))&&(document.cookie=e(o,n,r,s,c,i,a),!0)},removeItem:function(o,t,n,r,s){return!!this.hasItem(o)&&(document.cookie=e(o,"","Thu, 01 Jan 1970 00:00:00 GMT",t,n,r,s),!0)},hasItem:function(e){return!(!e||t.test(e))&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(o,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),o=e.length,t=0;t<o;t++)e[t]=decodeURIComponent(e[t]);return e},clear:function(e,o,t,n){for(var r=this.keys(),s=r.length,c=0;c<s;c++)this.removeItem(r[c],e,o,t,n)}}}(),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=docCookies);
  
  //cookies
  function maxAgeToGMT (nMaxAge) {
  return nMaxAge === Infinity ? "Fri, 31 Dec 9999 23:59:59 GMT" : (new Date(nMaxAge * 1e3 + Date.now())).toUTCString();
  }
  
  if (document.getElementById('shopify-section-mailchimp')) {
    const closeThis = document.getElementById('closeThis');
    const theThis = document.getElementById('shopify-section-mailchimp');
    if (docCookies.hasItem("mailchimpPopup")) { 
      // tumbleweed
      console.log("Not happening");
    } else {
      console.log("happening");
      window.setTimeout( function() {
        theThis.classList.add('active');
      }, 10000); 
      closeThis.addEventListener('click',function(e) {
        docCookies.setItem("mailchimpPopup", "Seen", maxAgeToGMT(31536000), "/");
        theThis.classList.remove('active');
      });
    }
  }
  </script>

{%- endif -%}
{% schema %}
{
  "name": {
    "en": "MC Newsletter popup"
  },
  "class": "index-section mailychimpster",
  "settings": [
    {
      "type": "text",
      "id": "chimp_url",
      "label": {
        "en": "Mailchimp form url"
      }
    },
    {
      "type": "text",
      "id": "section_title",
      "label": {
        "en": "Heading"
      },
      "default": {
        "en": "Subscribe to our newsletter"
      }
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": {
        "en": "Subheading"},
      "default": "<p>Promotions, new products and sales. Directly to your inbox.</p>"
    },
    {
    "type": "image_picker",
      "id": "image",
      "label": {
        "en": "Image"
      }
    },
    {
      "id": "show_name",
      "type": "checkbox",
      "label": {
        "en": "Show First Name Field"
      },
      "default": true
    },
    {
      "id": "disable",
      "type": "checkbox",
      "label": {
        "en": "Disable Popup"
      },
      "default": false
    }
  ],
  "presets": [
    {
      "name": {
        "en": "Mailchimp Newsletter"
      },
      "category": {
        "en": "Promotional"
      }
    }
  ]
}
{% endschema %}
