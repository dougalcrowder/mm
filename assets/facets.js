(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:String(r)}function c(t,r,n){return r=m(r),function(t,r){if(r&&("object"===e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}(t,f()?Reflect.construct(r,n||[],m(t).constructor):r.apply(t,n))}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(f())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&d(o,r.prototype),o}(e,arguments,m(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)},s(e)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var y=function(e){function r(){var e;n(this,r),(e=c(this,r)).onActiveFilterClick=e.onActiveFilterClick.bind(u(e)),e.debouncedOnSubmit=debounce((function(t){e.onSubmitHandler(t)}),500),e.querySelector("form").addEventListener("input",e.debouncedOnSubmit.bind(u(e)));var t=e.querySelector("#FacetsWrapperDesktop");return t&&t.addEventListener("keyup",onKeyUpEscape),e}return l(r,e),i(r,[{key:"onSubmitHandler",value:function(e){e.preventDefault();var t=new FormData(e.target.closest("form")),n=new URLSearchParams(t).toString();r.renderPage(n,e)}},{key:"onActiveFilterClick",value:function(e){e.preventDefault(),r.toggleActiveFacets(),r.renderPage(new URL(e.currentTarget.href).searchParams.toString())}}],[{key:"setListeners",value:function(){window.addEventListener("popstate",(function(e){var t=e.state?e.state.searchParams:r.searchParamsInitial;t!==r.searchParamsPrev&&r.renderPage(t,null,!1)}))}},{key:"toggleActiveFacets",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];document.querySelectorAll(".js-facet-remove").forEach((function(t){t.classList.toggle("disabled",e)}))}},{key:"renderPage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r.searchParamsPrev=e;var o=r.getSections(),i=document.getElementById("ProductCount"),a=document.getElementById("ProductCountDesktop");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading"),i&&i.classList.add("loading"),a&&a.classList.add("loading"),o.forEach((function(n){var o="".concat(window.location.pathname,"?section_id=").concat(n.section,"&").concat(e),i=function(e){return e.url===o};r.filterData.some(i)?r.renderSectionFromCache(i,t):r.renderSectionFromFetch(o,t)})),n&&r.updateURLHash(e)}},{key:"renderSectionFromFetch",value:function(e,n){fetch(e).then((function(e){return e.text()})).then((function(o){var i=o;r.filterData=[].concat(t(r.filterData),[{html:i,url:e}]),r.renderFilters(i,n),r.renderProductGridContainer(i),r.renderProductCount(i)}))}},{key:"renderSectionFromCache",value:function(e,t){var n=r.filterData.find(e).html;r.renderFilters(n,t),r.renderProductGridContainer(n),r.renderProductCount(n)}},{key:"renderProductGridContainer",value:function(e){document.getElementById("ProductGridContainer").innerHTML=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML}},{key:"renderProductCount",value:function(e){var t=(new DOMParser).parseFromString(e,"text/html").getElementById("ProductCount").innerHTML,r=document.getElementById("ProductCount"),n=document.getElementById("ProductCountDesktop");r.innerHTML=t,r.classList.remove("loading"),n&&(n.innerHTML=t,n.classList.remove("loading"))}},{key:"renderFilters",value:function(e,t){var n=(new DOMParser).parseFromString(e,"text/html"),o=n.querySelectorAll("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersFormMobileTwo .js-filter"),i=function(e){var r=t?t.target.closest(".js-filter"):void 0;return!!r&&e.dataset.index===r.dataset.index},a=Array.from(o).filter((function(e){return!i(e)})),c=Array.from(o).find(i);a.forEach((function(e){document.querySelector('.js-filter[data-index="'.concat(e.dataset.index,'"]')).innerHTML=e.innerHTML})),r.renderActiveFacets(n),r.renderAdditionalElements(n),c&&r.renderCounts(c,t.target.closest(".js-filter"))}},{key:"renderActiveFacets",value:function(e){[".active-facets-mobile",".active-facets-desktop"].forEach((function(t){var r=e.querySelector(t);r&&(document.querySelector(t).innerHTML=r.innerHTML)})),r.toggleActiveFacets(!1)}},{key:"renderAdditionalElements",value:function(e){[".mobile-facets__open",".mobile-facets__count",".sorting"].forEach((function(t){e.querySelector(t)&&(document.querySelector(t).innerHTML=e.querySelector(t).innerHTML)})),document.getElementById("FacetFiltersFormMobile").closest("menu-drawer").bindEvents()}},{key:"renderCounts",value:function(e,t){var r=t.querySelector(".facets__selected");e.querySelector(".facets__selected")&&r&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML)}},{key:"updateURLHash",value:function(e){history.pushState({searchParams:e},"","".concat(window.location.pathname).concat(e&&"?".concat(e)))}},{key:"getSections",value:function(){return[{section:document.getElementById("product-grid").dataset.id}]}}]),r}(s(HTMLElement));y.filterData=[],y.searchParamsInitial=window.location.search.slice(1),y.searchParamsPrev=window.location.search.slice(1),customElements.define("facet-filters-form",y),y.setListeners();var v=function(e){function t(){var e;return n(this,t),(e=c(this,t)).querySelectorAll("input").forEach((function(t){return t.addEventListener("change",e.onRangeChange.bind(u(e)))})),e.setMinAndMaxValues(),e}return l(t,e),i(t,[{key:"onRangeChange",value:function(e){this.adjustToValidValues(e.currentTarget),this.setMinAndMaxValues()}},{key:"setMinAndMaxValues",value:function(){var e=this.querySelectorAll("input"),t=e[0],r=e[1];r.value&&t.setAttribute("max",r.value),t.value&&r.setAttribute("min",t.value),""===t.value&&r.setAttribute("min",0),""===r.value&&t.setAttribute("max",r.getAttribute("max"))}},{key:"adjustToValidValues",value:function(e){var t=Number(e.value),r=Number(e.getAttribute("min")),n=Number(e.getAttribute("max"));t<r&&(e.value=r),t>n&&(e.value=n)}}]),t}(s(HTMLElement));customElements.define("price-range",v);var p=function(e){function t(){var e;return n(this,t),(e=c(this,t)).querySelector("a").addEventListener("click",(function(t){t.preventDefault(),(e.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(t)})),e}return l(t,e),i(t)}(s(HTMLElement));customElements.define("facet-remove",p)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkUsRUFBV0YsRUFBTyxHQUNwQkUsRUFBU3RHLE9BQU9xRyxFQUFTRSxhQUFhLE1BQU9ELEVBQVN0RyxPQUN0RHFHLEVBQVNyRyxPQUFPc0csRUFBU0MsYUFBYSxNQUFPRixFQUFTckcsT0FDbkMsS0FBbkJxRyxFQUFTckcsT0FBY3NHLEVBQVNDLGFBQWEsTUFBTyxHQUNqQyxLQUFuQkQsRUFBU3RHLE9BQWNxRyxFQUFTRSxhQUFhLE1BQU9ELEVBQVNFLGFBQWEsT0FDaEYsR0FBQyxDQUFBekcsSUFBQSxzQkFBQUMsTUFFRCxTQUFvQnlHLEdBQ2xCLElBQU16RyxFQUFRMEcsT0FBT0QsRUFBTXpHLE9BQ3JCMkcsRUFBTUQsT0FBT0QsRUFBTUQsYUFBYSxRQUNoQ0ksRUFBTUYsT0FBT0QsRUFBTUQsYUFBYSxRQUVsQ3hHLEVBQVEyRyxJQUFLRixFQUFNekcsTUFBUTJHLEdBQzNCM0csRUFBUTRHLElBQUtILEVBQU16RyxNQUFRNEcsRUFDakMsS0FBQ2YsQ0FBQSxDQS9CYSxDQStCYlAsRUEvQnNCQyxjQWtDekJHLGVBQWVDLE9BQU8sY0FBZUUsR0FBWSxJQUUzQ2dCLEVBQVcsU0FBQUMsR0FDZixTQUFBRCxJQUFjLElBQUFFLEVBTVQsT0FOUy9ILEVBQUEsS0FBQTZILElBQ1pFLEVBQUE5SCxFQUFBLEtBQUE0SCxJQUNLcEgsY0FBYyxLQUFLQyxpQkFBaUIsU0FBUyxTQUFDSCxHQUNqREEsRUFBTVUsa0JBQ084RyxFQUFLMUcsUUFBUSx1QkFBeUJpQixTQUFTN0IsY0FBYyx1QkFDckVQLG9CQUFvQkssRUFDM0IsSUFBR3dILENBQ0wsQ0FBQyxPQVJjbEgsRUFBQWdILEVBQUFDLEdBUWRoSCxFQUFBK0csRUFBQSxDQVJjLENBUWR2QixFQVJ1QkMsY0FXMUJHLGVBQWVDLE9BQU8sZUFBZ0JrQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW0vLi9qcy9mYWNldHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRmFjZXRGaWx0ZXJzRm9ybSBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLm9uQWN0aXZlRmlsdGVyQ2xpY2sgPSB0aGlzLm9uQWN0aXZlRmlsdGVyQ2xpY2suYmluZCh0aGlzKTtcblxuICAgIHRoaXMuZGVib3VuY2VkT25TdWJtaXQgPSBkZWJvdW5jZSgoZXZlbnQpID0+IHtcbiAgICAgIHRoaXMub25TdWJtaXRIYW5kbGVyKGV2ZW50KTtcbiAgICB9LCA1MDApO1xuXG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCdmb3JtJykuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLmRlYm91bmNlZE9uU3VibWl0LmJpbmQodGhpcykpO1xuICAgIFxuICAgIGNvbnN0IGZhY2V0V3JhcHBlciA9IHRoaXMucXVlcnlTZWxlY3RvcignI0ZhY2V0c1dyYXBwZXJEZXNrdG9wJyk7XG4gICAgaWYgKGZhY2V0V3JhcHBlcikgZmFjZXRXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgb25LZXlVcEVzY2FwZSk7XG4gIH1cblxuICBzdGF0aWMgc2V0TGlzdGVuZXJzKCkge1xuICAgIGNvbnN0IG9uSGlzdG9yeUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gZXZlbnQuc3RhdGUgPyBldmVudC5zdGF0ZS5zZWFyY2hQYXJhbXMgOiBGYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc0luaXRpYWw7XG4gICAgICBpZiAoc2VhcmNoUGFyYW1zID09PSBGYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc1ByZXYpIHJldHVybjtcbiAgICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUGFnZShzZWFyY2hQYXJhbXMsIG51bGwsIGZhbHNlKTtcbiAgICB9XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgb25IaXN0b3J5Q2hhbmdlKTtcbiAgfVxuXG4gIHN0YXRpYyB0b2dnbGVBY3RpdmVGYWNldHMoZGlzYWJsZSA9IHRydWUpIHtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuanMtZmFjZXQtcmVtb3ZlJykuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdkaXNhYmxlZCcsIGRpc2FibGUpO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclBhZ2Uoc2VhcmNoUGFyYW1zLCBldmVudCwgdXBkYXRlVVJMSGFzaCA9IHRydWUpIHtcbiAgICBGYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc1ByZXYgPSBzZWFyY2hQYXJhbXM7XG4gICAgY29uc3Qgc2VjdGlvbnMgPSBGYWNldEZpbHRlcnNGb3JtLmdldFNlY3Rpb25zKCk7XG4gICAgY29uc3QgY291bnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnUHJvZHVjdENvdW50Jyk7XG4gICAgY29uc3QgY291bnRDb250YWluZXJEZXNrdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RDb3VudERlc2t0b3AnKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnUHJvZHVjdEdyaWRDb250YWluZXInKS5xdWVyeVNlbGVjdG9yKCcuY29sbGVjdGlvbicpLmNsYXNzTGlzdC5hZGQoJ2xvYWRpbmcnKTtcbiAgICBpZiAoY291bnRDb250YWluZXIpe1xuICAgICAgY291bnRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgIH0gICAgXG4gICAgaWYgKGNvdW50Q29udGFpbmVyRGVza3RvcCl7XG4gICAgICBjb3VudENvbnRhaW5lckRlc2t0b3AuY2xhc3NMaXN0LmFkZCgnbG9hZGluZycpO1xuICAgIH1cblxuICAgIHNlY3Rpb25zLmZvckVhY2goKHNlY3Rpb24pID0+IHtcbiAgICAgIGNvbnN0IHVybCA9IGAke3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX0/c2VjdGlvbl9pZD0ke3NlY3Rpb24uc2VjdGlvbn0mJHtzZWFyY2hQYXJhbXN9YDtcbiAgICAgIGNvbnN0IGZpbHRlckRhdGFVcmwgPSBlbGVtZW50ID0+IGVsZW1lbnQudXJsID09PSB1cmw7XG5cbiAgICAgIEZhY2V0RmlsdGVyc0Zvcm0uZmlsdGVyRGF0YS5zb21lKGZpbHRlckRhdGFVcmwpID9cbiAgICAgICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJTZWN0aW9uRnJvbUNhY2hlKGZpbHRlckRhdGFVcmwsIGV2ZW50KSA6XG4gICAgICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyU2VjdGlvbkZyb21GZXRjaCh1cmwsIGV2ZW50KTtcbiAgICB9KTtcblxuICAgIGlmICh1cGRhdGVVUkxIYXNoKSBGYWNldEZpbHRlcnNGb3JtLnVwZGF0ZVVSTEhhc2goc2VhcmNoUGFyYW1zKTtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJTZWN0aW9uRnJvbUZldGNoKHVybCwgZXZlbnQpIHtcbiAgICBmZXRjaCh1cmwpXG4gICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpXG4gICAgICAudGhlbigocmVzcG9uc2VUZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IGh0bWwgPSByZXNwb25zZVRleHQ7XG4gICAgICAgIEZhY2V0RmlsdGVyc0Zvcm0uZmlsdGVyRGF0YSA9IFsuLi5GYWNldEZpbHRlcnNGb3JtLmZpbHRlckRhdGEsIHsgaHRtbCwgdXJsIH1dO1xuICAgICAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlckZpbHRlcnMoaHRtbCwgZXZlbnQpO1xuICAgICAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlclByb2R1Y3RHcmlkQ29udGFpbmVyKGh0bWwpO1xuICAgICAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlclByb2R1Y3RDb3VudChodG1sKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlclNlY3Rpb25Gcm9tQ2FjaGUoZmlsdGVyRGF0YVVybCwgZXZlbnQpIHtcbiAgICBjb25zdCBodG1sID0gRmFjZXRGaWx0ZXJzRm9ybS5maWx0ZXJEYXRhLmZpbmQoZmlsdGVyRGF0YVVybCkuaHRtbDtcbiAgICBGYWNldEZpbHRlcnNGb3JtLnJlbmRlckZpbHRlcnMoaHRtbCwgZXZlbnQpO1xuICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUHJvZHVjdEdyaWRDb250YWluZXIoaHRtbCk7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJQcm9kdWN0Q291bnQoaHRtbCk7XG4gIH1cblxuICBzdGF0aWMgcmVuZGVyUHJvZHVjdEdyaWRDb250YWluZXIoaHRtbCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0R3JpZENvbnRhaW5lcicpLmlubmVySFRNTCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpLmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0R3JpZENvbnRhaW5lcicpLmlubmVySFRNTDtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJQcm9kdWN0Q291bnQoaHRtbCkge1xuICAgIGNvbnN0IGNvdW50ID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhodG1sLCAndGV4dC9odG1sJykuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RDb3VudCcpLmlubmVySFRNTFxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdQcm9kdWN0Q291bnQnKTtcbiAgICBjb25zdCBjb250YWluZXJEZXNrdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1Byb2R1Y3RDb3VudERlc2t0b3AnKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gY291bnQ7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRpbmcnKTtcbiAgICBpZiAoY29udGFpbmVyRGVza3RvcCkge1xuICAgICAgY29udGFpbmVyRGVza3RvcC5pbm5lckhUTUwgPSBjb3VudDtcbiAgICAgIGNvbnRhaW5lckRlc2t0b3AuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGluZycpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJGaWx0ZXJzKGh0bWwsIGV2ZW50KSB7XG4gICAgY29uc3QgcGFyc2VkSFRNTCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpO1xuXG4gICAgY29uc3QgZmFjZXREZXRhaWxzRWxlbWVudHMgPVxuICAgICAgcGFyc2VkSFRNTC5xdWVyeVNlbGVjdG9yQWxsKCcjRmFjZXRGaWx0ZXJzRm9ybSAuanMtZmlsdGVyLCAjRmFjZXRGaWx0ZXJzRm9ybU1vYmlsZSAuanMtZmlsdGVyLCAjRmFjZXRGaWx0ZXJzRm9ybU1vYmlsZVR3byAuanMtZmlsdGVyJyk7XG4gICAgY29uc3QgbWF0Y2hlc0luZGV4ID0gKGVsZW1lbnQpID0+IHsgXG4gICAgICBjb25zdCBqc0ZpbHRlciA9IGV2ZW50ID8gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5qcy1maWx0ZXInKSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiBqc0ZpbHRlciA/IGVsZW1lbnQuZGF0YXNldC5pbmRleCA9PT0ganNGaWx0ZXIuZGF0YXNldC5pbmRleCA6IGZhbHNlOyBcbiAgICB9XG4gICAgY29uc3QgZmFjZXRzVG9SZW5kZXIgPSBBcnJheS5mcm9tKGZhY2V0RGV0YWlsc0VsZW1lbnRzKS5maWx0ZXIoZWxlbWVudCA9PiAhbWF0Y2hlc0luZGV4KGVsZW1lbnQpKTtcbiAgICBjb25zdCBjb3VudHNUb1JlbmRlciA9IEFycmF5LmZyb20oZmFjZXREZXRhaWxzRWxlbWVudHMpLmZpbmQobWF0Y2hlc0luZGV4KTtcblxuICAgIGZhY2V0c1RvUmVuZGVyLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5qcy1maWx0ZXJbZGF0YS1pbmRleD1cIiR7ZWxlbWVudC5kYXRhc2V0LmluZGV4fVwiXWApLmlubmVySFRNTCA9IGVsZW1lbnQuaW5uZXJIVE1MO1xuICAgIH0pO1xuXG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJBY3RpdmVGYWNldHMocGFyc2VkSFRNTCk7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJBZGRpdGlvbmFsRWxlbWVudHMocGFyc2VkSFRNTCk7XG5cbiAgICBpZiAoY291bnRzVG9SZW5kZXIpIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyQ291bnRzKGNvdW50c1RvUmVuZGVyLCBldmVudC50YXJnZXQuY2xvc2VzdCgnLmpzLWZpbHRlcicpKTtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJBY3RpdmVGYWNldHMoaHRtbCkge1xuICAgIGNvbnN0IGFjdGl2ZUZhY2V0RWxlbWVudFNlbGVjdG9ycyA9IFsnLmFjdGl2ZS1mYWNldHMtbW9iaWxlJywgJy5hY3RpdmUtZmFjZXRzLWRlc2t0b3AnXTtcblxuICAgIGFjdGl2ZUZhY2V0RWxlbWVudFNlbGVjdG9ycy5mb3JFYWNoKChzZWxlY3RvcikgPT4ge1xuICAgICAgY29uc3QgYWN0aXZlRmFjZXRzRWxlbWVudCA9IGh0bWwucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICBpZiAoIWFjdGl2ZUZhY2V0c0VsZW1lbnQpIHJldHVybjtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpLmlubmVySFRNTCA9IGFjdGl2ZUZhY2V0c0VsZW1lbnQuaW5uZXJIVE1MO1xuICAgIH0pXG5cbiAgICBGYWNldEZpbHRlcnNGb3JtLnRvZ2dsZUFjdGl2ZUZhY2V0cyhmYWxzZSk7XG4gIH1cblxuICBzdGF0aWMgcmVuZGVyQWRkaXRpb25hbEVsZW1lbnRzKGh0bWwpIHtcbiAgICBjb25zdCBtb2JpbGVFbGVtZW50U2VsZWN0b3JzID0gWycubW9iaWxlLWZhY2V0c19fb3BlbicsICcubW9iaWxlLWZhY2V0c19fY291bnQnLCAnLnNvcnRpbmcnXTtcblxuICAgIG1vYmlsZUVsZW1lbnRTZWxlY3RvcnMuZm9yRWFjaCgoc2VsZWN0b3IpID0+IHtcbiAgICAgIGlmICghaHRtbC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSkgcmV0dXJuO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcikuaW5uZXJIVE1MID0gaHRtbC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKS5pbm5lckhUTUw7XG4gICAgfSk7XG5cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnRmFjZXRGaWx0ZXJzRm9ybU1vYmlsZScpLmNsb3Nlc3QoJ21lbnUtZHJhd2VyJykuYmluZEV2ZW50cygpO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlckNvdW50cyhzb3VyY2UsIHRhcmdldCkge1xuICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSB0YXJnZXQucXVlcnlTZWxlY3RvcignLmZhY2V0c19fc2VsZWN0ZWQnKTtcbiAgICBjb25zdCBzb3VyY2VFbGVtZW50ID0gc291cmNlLnF1ZXJ5U2VsZWN0b3IoJy5mYWNldHNfX3NlbGVjdGVkJyk7XG5cbiAgICBpZiAoc291cmNlRWxlbWVudCAmJiB0YXJnZXRFbGVtZW50KSB7XG4gICAgICB0YXJnZXQucXVlcnlTZWxlY3RvcignLmZhY2V0c19fc2VsZWN0ZWQnKS5vdXRlckhUTUwgPSBzb3VyY2UucXVlcnlTZWxlY3RvcignLmZhY2V0c19fc2VsZWN0ZWQnKS5vdXRlckhUTUw7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIHVwZGF0ZVVSTEhhc2goc2VhcmNoUGFyYW1zKSB7XG4gICAgaGlzdG9yeS5wdXNoU3RhdGUoeyBzZWFyY2hQYXJhbXMgfSwgJycsIGAke3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX0ke3NlYXJjaFBhcmFtcyAmJiAnPycuY29uY2F0KHNlYXJjaFBhcmFtcyl9YCk7XG4gIH1cblxuICBzdGF0aWMgZ2V0U2VjdGlvbnMoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgc2VjdGlvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2R1Y3QtZ3JpZCcpLmRhdGFzZXQuaWQsXG4gICAgICB9XG4gICAgXVxuICB9XG5cbiAgb25TdWJtaXRIYW5kbGVyKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShldmVudC50YXJnZXQuY2xvc2VzdCgnZm9ybScpKTtcbiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGZvcm1EYXRhKS50b1N0cmluZygpO1xuICAgIEZhY2V0RmlsdGVyc0Zvcm0ucmVuZGVyUGFnZShzZWFyY2hQYXJhbXMsIGV2ZW50KTtcbiAgfVxuXG4gIG9uQWN0aXZlRmlsdGVyQ2xpY2soZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIEZhY2V0RmlsdGVyc0Zvcm0udG9nZ2xlQWN0aXZlRmFjZXRzKCk7XG4gICAgRmFjZXRGaWx0ZXJzRm9ybS5yZW5kZXJQYWdlKG5ldyBVUkwoZXZlbnQuY3VycmVudFRhcmdldC5ocmVmKS5zZWFyY2hQYXJhbXMudG9TdHJpbmcoKSk7XG4gIH1cbn1cblxuRmFjZXRGaWx0ZXJzRm9ybS5maWx0ZXJEYXRhID0gW107XG5GYWNldEZpbHRlcnNGb3JtLnNlYXJjaFBhcmFtc0luaXRpYWwgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpO1xuRmFjZXRGaWx0ZXJzRm9ybS5zZWFyY2hQYXJhbXNQcmV2ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zbGljZSgxKTtcbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgnZmFjZXQtZmlsdGVycy1mb3JtJywgRmFjZXRGaWx0ZXJzRm9ybSk7XG5GYWNldEZpbHRlcnNGb3JtLnNldExpc3RlbmVycygpO1xuXG5jbGFzcyBQcmljZVJhbmdlIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQnKVxuICAgICAgLmZvckVhY2goZWxlbWVudCA9PiBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHRoaXMub25SYW5nZUNoYW5nZS5iaW5kKHRoaXMpKSk7XG5cbiAgICB0aGlzLnNldE1pbkFuZE1heFZhbHVlcygpO1xuICB9XG5cbiAgb25SYW5nZUNoYW5nZShldmVudCkge1xuICAgIHRoaXMuYWRqdXN0VG9WYWxpZFZhbHVlcyhldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLnNldE1pbkFuZE1heFZhbHVlcygpO1xuICB9XG5cbiAgc2V0TWluQW5kTWF4VmFsdWVzKCkge1xuICAgIGNvbnN0IGlucHV0cyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW5wdXQnKTtcbiAgICBjb25zdCBtaW5JbnB1dCA9IGlucHV0c1swXTtcbiAgICBjb25zdCBtYXhJbnB1dCA9IGlucHV0c1sxXTtcbiAgICBpZiAobWF4SW5wdXQudmFsdWUpIG1pbklucHV0LnNldEF0dHJpYnV0ZSgnbWF4JywgbWF4SW5wdXQudmFsdWUpO1xuICAgIGlmIChtaW5JbnB1dC52YWx1ZSkgbWF4SW5wdXQuc2V0QXR0cmlidXRlKCdtaW4nLCBtaW5JbnB1dC52YWx1ZSk7XG4gICAgaWYgKG1pbklucHV0LnZhbHVlID09PSAnJykgbWF4SW5wdXQuc2V0QXR0cmlidXRlKCdtaW4nLCAwKTtcbiAgICBpZiAobWF4SW5wdXQudmFsdWUgPT09ICcnKSBtaW5JbnB1dC5zZXRBdHRyaWJ1dGUoJ21heCcsIG1heElucHV0LmdldEF0dHJpYnV0ZSgnbWF4JykpO1xuICB9XG5cbiAgYWRqdXN0VG9WYWxpZFZhbHVlcyhpbnB1dCkge1xuICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyKGlucHV0LnZhbHVlKTtcbiAgICBjb25zdCBtaW4gPSBOdW1iZXIoaW5wdXQuZ2V0QXR0cmlidXRlKCdtaW4nKSk7XG4gICAgY29uc3QgbWF4ID0gTnVtYmVyKGlucHV0LmdldEF0dHJpYnV0ZSgnbWF4JykpO1xuXG4gICAgaWYgKHZhbHVlIDwgbWluKSBpbnB1dC52YWx1ZSA9IG1pbjtcbiAgICBpZiAodmFsdWUgPiBtYXgpIGlucHV0LnZhbHVlID0gbWF4O1xuICB9XG59XG5cbmN1c3RvbUVsZW1lbnRzLmRlZmluZSgncHJpY2UtcmFuZ2UnLCBQcmljZVJhbmdlKTtcblxuY2xhc3MgRmFjZXRSZW1vdmUgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5xdWVyeVNlbGVjdG9yKCdhJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBmb3JtID0gdGhpcy5jbG9zZXN0KCdmYWNldC1maWx0ZXJzLWZvcm0nKSB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmYWNldC1maWx0ZXJzLWZvcm0nKTtcbiAgICAgIGZvcm0ub25BY3RpdmVGaWx0ZXJDbGljayhldmVudCk7XG4gICAgfSk7XG4gIH1cbn1cblxuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCdmYWNldC1yZW1vdmUnLCBGYWNldFJlbW92ZSk7XG4iXSwibmFtZXMiOlsiRmFjZXRGaWx0ZXJzRm9ybSIsIl9IVE1MRWxlbWVudCIsIl90aGlzIiwiX2NsYXNzQ2FsbENoZWNrIiwiX2NhbGxTdXBlciIsIm9uQWN0aXZlRmlsdGVyQ2xpY2siLCJiaW5kIiwiX2Fzc2VydFRoaXNJbml0aWFsaXplZCIsImRlYm91bmNlZE9uU3VibWl0IiwiZGVib3VuY2UiLCJldmVudCIsIm9uU3VibWl0SGFuZGxlciIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiZmFjZXRXcmFwcGVyIiwib25LZXlVcEVzY2FwZSIsIl9pbmhlcml0cyIsIl9jcmVhdGVDbGFzcyIsImtleSIsInZhbHVlIiwicHJldmVudERlZmF1bHQiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwidGFyZ2V0IiwiY2xvc2VzdCIsInNlYXJjaFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsInRvU3RyaW5nIiwicmVuZGVyUGFnZSIsInRvZ2dsZUFjdGl2ZUZhY2V0cyIsIlVSTCIsImN1cnJlbnRUYXJnZXQiLCJocmVmIiwid2luZG93Iiwic3RhdGUiLCJzZWFyY2hQYXJhbXNJbml0aWFsIiwic2VhcmNoUGFyYW1zUHJldiIsImRpc2FibGUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbWVudCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInVwZGF0ZVVSTEhhc2giLCJzZWN0aW9ucyIsImdldFNlY3Rpb25zIiwiY291bnRDb250YWluZXIiLCJnZXRFbGVtZW50QnlJZCIsImNvdW50Q29udGFpbmVyRGVza3RvcCIsImFkZCIsInNlY3Rpb24iLCJ1cmwiLCJjb25jYXQiLCJsb2NhdGlvbiIsInBhdGhuYW1lIiwiZmlsdGVyRGF0YVVybCIsImZpbHRlckRhdGEiLCJzb21lIiwicmVuZGVyU2VjdGlvbkZyb21DYWNoZSIsInJlbmRlclNlY3Rpb25Gcm9tRmV0Y2giLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsInRleHQiLCJyZXNwb25zZVRleHQiLCJodG1sIiwiX3RvQ29uc3VtYWJsZUFycmF5IiwicmVuZGVyRmlsdGVycyIsInJlbmRlclByb2R1Y3RHcmlkQ29udGFpbmVyIiwicmVuZGVyUHJvZHVjdENvdW50IiwiZmluZCIsImlubmVySFRNTCIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsImNvdW50IiwiY29udGFpbmVyIiwiY29udGFpbmVyRGVza3RvcCIsInJlbW92ZSIsInBhcnNlZEhUTUwiLCJmYWNldERldGFpbHNFbGVtZW50cyIsIm1hdGNoZXNJbmRleCIsImpzRmlsdGVyIiwiZGF0YXNldCIsImluZGV4IiwiZmFjZXRzVG9SZW5kZXIiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJjb3VudHNUb1JlbmRlciIsInJlbmRlckFjdGl2ZUZhY2V0cyIsInJlbmRlckFkZGl0aW9uYWxFbGVtZW50cyIsInJlbmRlckNvdW50cyIsInNlbGVjdG9yIiwiYWN0aXZlRmFjZXRzRWxlbWVudCIsImJpbmRFdmVudHMiLCJzb3VyY2UiLCJ0YXJnZXRFbGVtZW50Iiwib3V0ZXJIVE1MIiwiaGlzdG9yeSIsInB1c2hTdGF0ZSIsImlkIiwiX3dyYXBOYXRpdmVTdXBlciIsIkhUTUxFbGVtZW50Iiwic2VhcmNoIiwic2xpY2UiLCJjdXN0b21FbGVtZW50cyIsImRlZmluZSIsInNldExpc3RlbmVycyIsIlByaWNlUmFuZ2UiLCJfSFRNTEVsZW1lbnQyIiwiX3RoaXMyIiwib25SYW5nZUNoYW5nZSIsInNldE1pbkFuZE1heFZhbHVlcyIsInRoaXMiLCJhZGp1c3RUb1ZhbGlkVmFsdWVzIiwiaW5wdXRzIiwibWluSW5wdXQiLCJtYXhJbnB1dCIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsImlucHV0IiwiTnVtYmVyIiwibWluIiwibWF4IiwiRmFjZXRSZW1vdmUiLCJfSFRNTEVsZW1lbnQzIiwiX3RoaXMzIl0sInNvdXJjZVJvb3QiOiIifQ==